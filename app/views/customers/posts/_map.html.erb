<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY']%>&callback=initMap" async defer></script>

<script>
  function initMap() {
    const mapElement = document.getElementById("map");
    let map = null;
    let marker = null;

    const initialLocation = { lat: 35.6895, lng: 139.6917 };
    map = new google.maps.Map(mapElement, {
      center: initialLocation,
      zoom: 10,
    });

    const location = "<%= @post.location %>";
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({ address: location }, function(results, status) {
      if (status === "OK") {
        const locationLatLng = results[0].geometry.location;
        marker = new google.maps.Marker({
          position: locationLatLng,
          map: map,
        });
        map.setCenter(locationLatLng);
        map.setZoom(15);
      } else {
        console.error("Geocode was not successful for the following reason: " + status);
      }
    });
  }

  document.addEventListener("DOMContentLoaded", function() {
    initMap();
  });
</script>